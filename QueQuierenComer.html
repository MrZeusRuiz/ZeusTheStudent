<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meal of the Day</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
        }

        #meal-display {
            font-size: 24px;
            margin-bottom: 20px;
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
        }

        #select-button {
            padding: 15px 30px;
            font-size: 18px;
            cursor: pointer;
            background-color: #3498db;
            color: #fff;
            border: none;
            border-radius: 25px;
            outline: none;
            transition: background-color 0.3s ease-in-out;
        }

        #select-button:hover {
            background-color: #2980b9;
        }

        .disabled {
            background-color: #7f8c8d;
            cursor: not-allowed;
        }
    </style>
</head>
<body>

<div id="meal-display">Click the button to see today's meal!</div>
<button id="select-button" onclick="selectMeal()">Select Today's Meal</button>

<script>
    function selectMeal() {
        const meals = shuffle([
            "Tacos", "Tomatadas", "Spam and rice", "Sopita", "Pozole", "Spicy chipotle burger",
            "Garbanzos with rice", "Papas and caldillo", "Bistec en caldillo", 
            "Lentejas con pica salchicha and spinach", "Mole", "Carne asada con rice",
            "Chipotle chicken", "Rotisserie chicken from costco or safeway", "Pikadillo",
            "Flat breaded chicken", "Orange chicken", "Compow chicken", "Chow mein",
            "Albondigas de carne", "Kobe beef", "Pica pollo hot wings", "Sandwiches"
        ]);

        const selectedMeal = meals.pop();
        const visitorId = getVisitorId();
        const clickCount = parseInt(localStorage.getItem(`clickCount-${visitorId}`)) || 0;

        // Check if the click limit has been reached
        const clickLimit = 2;

        if (clickCount >= clickLimit) {
            alert(`You have reached the limit of ${clickLimit} clicks for today!`);
            document.getElementById('select-button').classList.add('disabled');
            return;
        }

        // Increment the click count
        localStorage.setItem(`clickCount-${visitorId}`, clickCount + 1);

        const lastMeal = localStorage.getItem(`lastMeal-${visitorId}`);

        // Check if the last meal is the same as the current selection
        if (lastMeal === selectedMeal) {
            // If it is, reselect a new meal
            selectMeal();
            return;
        }

        // Display the selected meal with a fade-in effect
        const mealDisplay = document.getElementById('meal-display');
        mealDisplay.style.opacity = 0;
        setTimeout(() => {
            mealDisplay.innerText = `Today's Meal: ${selectedMeal}`;
            mealDisplay.style.opacity = 1;
        }, 500); // Set a timeout to wait for the fade-out effect to complete

        // Save the selected meal to local storage
        localStorage.setItem(`lastMeal-${visitorId}`, selectedMeal);

        // Disable the button after the second click
        if (clickCount >= clickLimit - 1) {
            document.getElementById('select-button').classList.add('disabled');
        }
    }

    function shuffle(array) {
        let currentIndex = array.length, randomIndex;

        // While there remain elements to shuffle...
        while (currentIndex !== 0) {

            // Pick a remaining element...
            randomIndex = Math.floor(Math.random() * currentIndex);
            currentIndex--;

            // And swap it with the current element.
            [array[currentIndex], array[randomIndex]] = [array[randomIndex], array[currentIndex]];
        }

        return array;
    }

    function getVisitorId() {
        // Use a simple approach to generate a unique identifier for the visitor
        const date = new Date().toISOString();
        return date.replace(/\D/g, ''); // Remove non-numeric characters
    }

    // Display the last meal on page load
    const visitorId = getVisitorId();
    const lastMeal = localStorage.getItem(`lastMeal-${visitorId}`);
    if (lastMeal) {
        const mealDisplay = document.getElementById('meal-display');
        mealDisplay.innerText = `Today's Meal: ${lastMeal}`;
        mealDisplay.style.opacity = 1;

        // Disable the button if the click limit is reached
        const clickCount = parseInt(localStorage.getItem(`clickCount-${visitorId}`)) || 0;
        const clickLimit = 2;

        if (clickCount >= clickLimit) {
            document.getElementById('select-button').classList.add('disabled');
        }
    }
</script>

</body>
</html>
